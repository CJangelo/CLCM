<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette_7 • CLCM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vignette_7">
<meta property="og:description" content="CLCM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLCM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vig_1.html">Vignette_1</a>
    </li>
    <li>
      <a href="../articles/Vig_2.html">Vignette_2</a>
    </li>
    <li>
      <a href="../articles/Vig_3.html">Vignette_3</a>
    </li>
    <li>
      <a href="../articles/Vig_4.html">Vignette_4</a>
    </li>
    <li>
      <a href="../articles/Vig_5.html">Vignette_5</a>
    </li>
    <li>
      <a href="../articles/Vig_6.html">Vignette_6</a>
    </li>
    <li>
      <a href="../articles/Vig_7.html">Vignette_7</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Vig_7_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Vignette_7</h1>
            
      
      
      <div class="hidden name"><code>Vig_7.Rmd</code></div>

    </div>

    
    
<p>Vignette 7: Longitudinal Data with Multinomial Latent Regression</p>
<ol style="list-style-type: decimal">
<li>Timepoints: 2</li>
<li>Latent Classes: K=2, 2^K = 4 latent classes</li>
<li>Multinomial latent regression, Groups separate at timepoint 2</li>
</ol>
<p>The stratified transition matrix is a transition matrix estimated separately for different groups. This is essentially for type of latent regression. Here we regress the latent classes at timepoint 2 onto the observed <code>Group</code>, which allows us to estimate a stratified transition matrix - this is the output of interest when, for example, we look at the differences in treatment arms (observed groups) in the proportion of subjects moving from the “Sick” latent class to the “Not Sick” latent class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CLCM</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span></code></pre></div>
<p>Specify details of the data. Here we have 2,000 subjects belonging to 4 different latent classes responding to 16 items at 2 timepoints.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2000</span>
     <span class="va">number.timepoints</span> <span class="op">&lt;-</span> <span class="fl">2</span>
     <span class="va">item.type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Ordinal'</span>, <span class="st">'Nominal'</span>, <span class="st">'Poisson'</span>, <span class="st">'Neg_Binom'</span>, <span class="st">'ZINB'</span>, <span class="st">'ZIP'</span>, <span class="st">'Normal'</span>, <span class="st">'Beta'</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
     <span class="va">sim.categories.j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">30</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span> , <span class="fl">2</span><span class="op">)</span>
     <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">item.type</span><span class="op">)</span>
     <span class="va">item.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Item_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span>
     <span class="va">K</span><span class="op">=</span> <span class="fl">2</span>
     <span class="co">#alpha &lt;- pattern(K)</span>
     <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">J</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">J</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">J</span>, ncol <span class="op">=</span> <span class="va">K</span>, byrow <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
     <span class="co">#eta=alpha %*% t(Q)</span></code></pre></div>
<p>Generate the subject posteriors via (multinomial) latent regression. The latent class assignments will differ across the two observed groups (<code>Group</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">     <span class="va">number.groups</span> <span class="op">&lt;-</span> <span class="fl">2</span>
     <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
                  <span class="st">'USUBJID'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Subject_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, width <span class="op">=</span> <span class="fl">4</span>, flag <span class="op">=</span> <span class="st">'0'</span><span class="op">)</span><span class="op">)</span>, length.out<span class="op">=</span> <span class="va">N</span><span class="op">*</span><span class="va">number.timepoints</span><span class="op">)</span>,
                  <span class="st">'Group'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Group_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">number.groups</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">*</span><span class="va">number.timepoints</span><span class="op">)</span>,
                  <span class="st">'Time'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Time_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">number.timepoints</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,
                  stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>

      <span class="co"># Design Matrix</span>
      <span class="va">XX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Group</span><span class="op">*</span><span class="va">Time</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span> 
      <span class="co"># Beta</span>
      <span class="va">Beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">XX</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span> <span class="op">-</span> <span class="fl">1</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">XX</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'LC'</span>, <span class="fl">2</span><span class="op">^</span><span class="va">K</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
      <span class="va">Beta</span><span class="op">[</span><span class="st">'(Intercept)'</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span><span class="op">)</span>
      <span class="va">Beta</span><span class="op">[</span><span class="st">'GroupGroup_2'</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
      <span class="va">Beta</span><span class="op">[</span><span class="st">'TimeTime_2'</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
      <span class="va">Beta</span><span class="op">[</span><span class="st">'GroupGroup_2:TimeTime_2'</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">1.0</span>, <span class="op">-</span><span class="fl">1.6</span><span class="op">)</span>
      <span class="va">Beta</span>
<span class="co">#&gt;                          LC   LC   LC</span>
<span class="co">#&gt; (Intercept)             0.2  0.8  0.4</span>
<span class="co">#&gt; GroupGroup_2            0.0  0.0  0.0</span>
<span class="co">#&gt; TimeTime_2              0.0  0.0  0.0</span>
<span class="co">#&gt; GroupGroup_2:TimeTime_2 0.2 -1.0 -1.6</span>
      
      <span class="co"># Matrix multiply:</span>
      <span class="va">XB</span> <span class="op">&lt;-</span> <span class="va">XX</span> <span class="op">%*%</span> <span class="va">Beta</span>
      <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">XB</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">XB</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span>
      <span class="va">p</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="va">p</span><span class="op">)</span>
      <span class="va">lca</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
          <span class="va">lca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lca</span>, 
           <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="va">K</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span>  
                  <span class="op">)</span>
        <span class="op">}</span> <span class="co">#end loop to sample lca</span>
 </code></pre></div>
<p>At this point we have used the observed group membership (<code>Group</code>) to generate the (true) posterior distributions/latent class assignments for both timepoints. Let’s check the latent class assignments vs Observed group assignment. Again, we haven’t yet moved into latent class models yet.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">      <span class="co"># Check the LCA </span>
      <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">lca</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; lca</span>
<span class="co">#&gt;       1       2       3       4 </span>
<span class="co">#&gt; 0.19425 0.26225 0.33175 0.21175</span>
      <span class="co"># Check LCA across observed Groups:</span>
      <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">lca</span> <span class="op">+</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt;    dat$Group</span>
<span class="co">#&gt; lca   Group_1   Group_2</span>
<span class="co">#&gt;   1 0.4208494 0.5791506</span>
<span class="co">#&gt;   2 0.4070543 0.5929457</span>
<span class="co">#&gt;   3 0.5561417 0.4438583</span>
<span class="co">#&gt;   4 0.5997639 0.4002361</span></code></pre></div>
<p>Before we move on with the simulation, let’s just do a quick check on whether a simple multinomial logistic regression can recover this. Regress latent class assignment onto observed groups:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">      <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">lca</span><span class="op">)</span> <span class="op">~</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span><span class="op">*</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span>
<span class="co">#&gt; # weights:  20 (12 variable)</span>
<span class="co">#&gt; initial  value 5545.177444 </span>
<span class="co">#&gt; iter  10 value 5365.259567</span>
<span class="co">#&gt; final  value 5284.603876 </span>
<span class="co">#&gt; converged</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="co">#&gt;   (Intercept) dat$GroupGroup_2 dat$TimeTime_2 dat$GroupGroup_2:dat$TimeTime_2</span>
<span class="co">#&gt; 2   0.2725211       0.01043497    -0.01159203                      0.07390223</span>
<span class="co">#&gt; 3   0.8041709       0.06445540     0.01979793                     -1.21460930</span>
<span class="co">#&gt; 4   0.3891948       0.06736370     0.10159054                     -1.75415972</span>
      <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Beta</span><span class="op">)</span>
<span class="co">#&gt;    (Intercept) GroupGroup_2 TimeTime_2 GroupGroup_2:TimeTime_2</span>
<span class="co">#&gt; LC         0.2            0          0                     0.2</span>
<span class="co">#&gt; LC         0.8            0          0                    -1.0</span>
<span class="co">#&gt; LC         0.4            0          0                    -1.6</span></code></pre></div>
<p>Recovery seems fine. Let’s create the true posterior distributions and pass to the simulation function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">      <span class="co"># Create true posterior distributions, pass </span>
      <span class="va">post.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span><span class="op">)</span>
      <span class="va">post.true</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="va">lca</span><span class="op">)</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> 
      
      <span class="co"># Simulate Data</span>
        <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">03102021</span><span class="op">)</span>
      <span class="va">sim.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_clcm.html">simulate_clcm</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, number.timepoints <span class="op">=</span> <span class="va">number.timepoints</span>, 
                        Q <span class="op">=</span> <span class="va">Q</span>, 
                        item.names <span class="op">=</span> <span class="va">item.names</span>, 
                        item.type <span class="op">=</span> <span class="va">item.type</span>, 
                        categories.j <span class="op">=</span> <span class="va">sim.categories.j</span>, 
                        post <span class="op">=</span> <span class="va">post.true</span><span class="op">)</span></code></pre></div>
<p>Merge the dataframe with the Observed Group membership with the simulated dataframe. You need the <code>Group</code> variable with the item responses to pass to the model estimation function. If you don’t, the esimtation routine won’t have a <code>Group</code> variable to compute the multinomial latent regression with.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">      <span class="va">dat.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dat</span>, y <span class="op">=</span> <span class="va">sim.dat</span><span class="op">$</span><span class="va">dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'USUBJID'</span>, <span class="st">'Time'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Specify the latent regression formula - regress latent classes onto <code>Group</code> variable in model estimation by passing <code>lat.reg = list('Time_1' = NULL, 'Time_2' = 'Group')</code>. Note: if we had additional covariates, we would pass the corresponding regression formula, e.g. <code>'Group + Sex + Age'</code>. This will be passed to <code>as.formula</code> and then passed to a function that fits a regression.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">      <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clcm.html">clcm</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat.cov</span>, 
                 item.type <span class="op">=</span> <span class="va">item.type</span>, 
                 item.names <span class="op">=</span> <span class="va">item.names</span>, 
                 Q <span class="op">=</span> <span class="va">Q</span>, max.diff <span class="op">=</span> <span class="fl">0.001</span>, 
                 lat.reg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'Time_1'</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="st">'Time_2'</span> <span class="op">=</span> <span class="st">'Group'</span><span class="op">)</span> <span class="op">)</span>    
<span class="co">#&gt; iteration:  1   max diff in item parameter estimates:  8.761695 </span>
<span class="co">#&gt; iteration:  2   max diff in item parameter estimates:  7.725424 </span>
<span class="co">#&gt; iteration:  3   max diff in item parameter estimates:  0.071452 </span>
<span class="co">#&gt; iteration:  4   max diff in item parameter estimates:  0.000325</span></code></pre></div>
<p>Evaluate the Latent Regression Parameters:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
      <span class="va">Beta</span> <span class="co"># Generating parameter</span>
<span class="co">#&gt;                          LC   LC   LC</span>
<span class="co">#&gt; (Intercept)             0.2  0.8  0.4</span>
<span class="co">#&gt; GroupGroup_2            0.0  0.0  0.0</span>
<span class="co">#&gt; TimeTime_2              0.0  0.0  0.0</span>
<span class="co">#&gt; GroupGroup_2:TimeTime_2 0.2 -1.0 -1.6</span>
      <span class="va">mod</span><span class="op">$</span><span class="va">lat.reg.param</span>  <span class="co"># estimate</span>
<span class="co">#&gt;                    [,1]       [,2]       [,3]</span>
<span class="co">#&gt; (Intercept)  0.26093503  0.8239435  0.4907613</span>
<span class="co">#&gt; GroupGroup_2 0.08046943 -1.1513163 -1.6886650</span></code></pre></div>
<p>Evaluate the transition matrix, first not stratified across the <code>Group</code> variable, and compare that estimated transition matrix to the true transition matrix.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
      <span class="fu"><a href="../reference/transition_matrix_clcm.html">transition_matrix_clcm</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">mod</span>, stratification <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;            post_LC_00 post_LC_10 post_LC_01 post_LC_11</span>
<span class="co">#&gt; post_LC_00  0.2066112  0.3300088  0.3145425  0.1488374</span>
<span class="co">#&gt; post_LC_10  0.2365193  0.2985151  0.2816953  0.1832703</span>
<span class="co">#&gt; post_LC_01  0.2173337  0.3133441  0.2840001  0.1853221</span>
<span class="co">#&gt; post_LC_11  0.2438328  0.3002732  0.2845238  0.1713702</span>

      <span class="co"># Compare to Generating parameters</span>
      <span class="va">post.true1</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_1'</span>, <span class="op">]</span>
      <span class="va">post.true2</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_2'</span>, <span class="op">]</span>
      <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">post.true1</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">post.true2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">post.true1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, byrow <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]</span>
<span class="co">#&gt; [1,] 0.2061538 0.3292308 0.3138462 0.1507692</span>
<span class="co">#&gt; [2,] 0.2354312 0.3006993 0.2820513 0.1818182</span>
<span class="co">#&gt; [3,] 0.2173333 0.3133333 0.2840000 0.1853333</span>
<span class="co">#&gt; [4,] 0.2439516 0.3004032 0.2842742 0.1713710</span></code></pre></div>
<p>Appear to be very similar, very good recovery of the true generating parameters. Now let’s check the estimated transition matrix, stratified on the <code>Group</code> variable:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="co"># Estimated:</span>
  <span class="fu"><a href="../reference/transition_matrix_clcm.html">transition_matrix_clcm</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">mod</span>, stratification <span class="op">=</span> <span class="cn">T</span>, covariate <span class="op">=</span> <span class="st">'Group'</span><span class="op">)</span>
<span class="co">#&gt; $Group_1</span>
<span class="co">#&gt;            post_LC_00 post_LC_10 post_LC_01 post_LC_11</span>
<span class="co">#&gt; post_LC_00  0.1693071  0.2358204  0.3809935  0.2138790</span>
<span class="co">#&gt; post_LC_10  0.1829197  0.1783697  0.3658648  0.2728458</span>
<span class="co">#&gt; post_LC_01  0.1320761  0.2291399  0.3584705  0.2803135</span>
<span class="co">#&gt; post_LC_11  0.1796168  0.1877519  0.3714597  0.2611716</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Group_2</span>
<span class="co">#&gt;            post_LC_00 post_LC_10 post_LC_01 post_LC_11</span>
<span class="co">#&gt; post_LC_00  0.2454377  0.4280410  0.2453798 0.08114152</span>
<span class="co">#&gt; post_LC_10  0.2920229  0.4229285  0.1945358 0.09051284</span>
<span class="co">#&gt; post_LC_01  0.3007760  0.3957554  0.2111153 0.09235333</span>
<span class="co">#&gt; post_LC_11  0.3065353  0.4101426  0.1996369 0.08368529</span>

  <span class="co"># Compare to Generating parameters:</span>
  <span class="va">post.true11</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_1'</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Group_1'</span>, <span class="op">]</span>
  <span class="va">post.true12</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_1'</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Group_2'</span>, <span class="op">]</span>
  <span class="va">post.true21</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_2'</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Group_1'</span>, <span class="op">]</span>
  <span class="va">post.true22</span> <span class="op">&lt;-</span> <span class="va">post.true</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">Time</span> <span class="op">==</span> <span class="st">'Time_2'</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Group_2'</span>, <span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">post.true11</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">post.true21</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">post.true11</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, byrow <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]</span>
<span class="co">#&gt; [1,] 0.1686747 0.2349398 0.3795181 0.2168675</span>
<span class="co">#&gt; [2,] 0.1834862 0.1788991 0.3669725 0.2706422</span>
<span class="co">#&gt; [3,] 0.1320755 0.2291105 0.3584906 0.2803235</span>
<span class="co">#&gt; [4,] 0.1795918 0.1877551 0.3714286 0.2612245</span>
  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">post.true12</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">post.true22</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">post.true12</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">K</span>, byrow <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;           [,1]      [,2]      [,3]       [,4]</span>
<span class="co">#&gt; [1,] 0.2452830 0.4276730 0.2452830 0.08176101</span>
<span class="co">#&gt; [2,] 0.2890995 0.4265403 0.1943128 0.09004739</span>
<span class="co">#&gt; [3,] 0.3007916 0.3957784 0.2110818 0.09234828</span>
<span class="co">#&gt; [4,] 0.3067729 0.4103586 0.1992032 0.08366534</span></code></pre></div>
<p>Again, looks very close.</p>
<p>Next, compare true classification (latent class assignment, lca) with estimates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
      <span class="va">lca.hat</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">lca</span> 
      <span class="va">lca.true</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">true_lca</span>      
      <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">lca.true</span> <span class="op">==</span> <span class="va">lca.hat</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; FALSE  TRUE </span>
<span class="co">#&gt;     2  3998</span>
      <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">lca.true</span> <span class="op">==</span> <span class="va">lca.hat</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; </span>
<span class="co">#&gt;  FALSE   TRUE </span>
<span class="co">#&gt; 0.0005 0.9995</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">lca.true</span> <span class="op">+</span> <span class="va">lca.hat</span><span class="op">)</span>
<span class="co">#&gt;         lca.hat</span>
<span class="co">#&gt; lca.true    1    2    3    4</span>
<span class="co">#&gt;        1  776    1    0    0</span>
<span class="co">#&gt;        2    1 1048    0    0</span>
<span class="co">#&gt;        3    0    0 1327    0</span>
<span class="co">#&gt;        4    0    0    0  847</span></code></pre></div>
<p>Pretttyy Preeeeeetttty Preeeeettttty good.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Charlie Iaconangelo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
